  <!DOCTYPE html>
  <html lang="ko">
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ë°”ë‹¹ë•Œ</title>
  <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/gujwatourjeju-collab/seatime/main/logo.png">
  <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/gujwatourjeju-collab/seatime/main/logo.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="ë°”ë‹¹ë•Œ">
  <meta name="theme-color" content="#0d1f2d">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="logo.png">
  <link rel="manifest" href="data:application/json,{&quot;name&quot;:&quot;ë°”ë‹¹ë•Œ&quot;,&quot;short_name&quot;:&quot;ë°”ë‹¹ë•Œ&quot;,&quot;icons&quot;:[{&quot;src&quot;:&quot;https://raw.githubusercontent.com/gujwatourjeju-collab/seatime/main/logo.png&quot;,&quot;sizes&quot;:&quot;192x192&quot;,&quot;type&quot;:&quot;image/png&quot;}],&quot;start_url&quot;:&quot;.&quot;,&quot;display&quot;:&quot;standalone&quot;,&quot;background_color&quot;:&quot;#0d1f2d&quot;,&quot;theme_color&quot;:&quot;#0d1f2d&quot;}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700;900&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root { --accent:#00c4a7; --danger:#ff6b6b; --muted:#6b8fa3; }
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
    body{font-family:'Noto Sans KR',sans-serif;background:#0d1f2d;color:#fff;height:100dvh;overflow:hidden;display:flex;flex-direction:column;}

    /* â”€â”€â”€â”€â”€â”€ ìŠ¤í”Œë˜ì‹œ â”€â”€â”€â”€â”€â”€ */
    .splash{position:fixed;inset:0;z-index:9999;background:#0a1a28;display:flex;flex-direction:column;align-items:center;justify-content:center;overflow:hidden;transition:opacity 0.6s ease,transform 0.6s ease;}
    .splash.hide{opacity:0;transform:scale(1.04);pointer-events:none;}
    .splash-stars{position:absolute;inset:0;overflow:hidden;}
    .splash-star{position:absolute;width:2px;height:2px;background:#fff;border-radius:50%;opacity:0;animation:starTwinkle var(--dur,3s) ease-in-out var(--delay,0s) infinite;}
    @keyframes starTwinkle{0%,100%{opacity:0;transform:scale(0.5)}50%{opacity:var(--op,0.6);transform:scale(1)}}
    .splash-water{position:absolute;bottom:0;left:0;right:0;height:0%;overflow:visible;transition:height 0s;pointer-events:none;}
    .splash-water-body{position:absolute;top:-40px;left:0;right:0;bottom:0;background:linear-gradient(180deg,rgba(0,196,167,0) 0%,rgba(0,196,167,0.15) 15%,rgba(0,140,120,0.45) 45%,rgba(0,80,70,0.75) 100%);overflow:hidden;}
    .splash-water-body::before{content:"";position:absolute;top:0;left:-60%;width:220%;height:40px;background:rgba(0,196,167,0.4);border-radius:50%;animation:splashWave 3.6s ease-in-out infinite;}
    .splash-water-body::after{content:"";position:absolute;top:8px;left:-40%;width:180%;height:28px;background:rgba(0,196,167,0.22);border-radius:50%;animation:splashWave 5s ease-in-out -1.8s infinite;}
    @keyframes splashWave{0%,100%{transform:translateX(0)}50%{transform:translateX(-8%)}}
    .splash-water-shimmer{position:absolute;inset:0;background:linear-gradient(135deg,transparent 30%,rgba(0,196,167,0.07) 50%,transparent 70%);animation:shimmerMove 4s ease-in-out infinite;}
    @keyframes shimmerMove{0%,100%{transform:translateX(-100%) skewX(-20deg)}50%{transform:translateX(200%) skewX(-20deg)}}
    .splash-content{position:relative;z-index:2;display:flex;flex-direction:column;align-items:center;}
    .splash-logo-wrap{position:relative;width:96px;height:96px;margin-bottom:20px;}
    .splash-logo-ring{position:absolute;inset:-10px;border-radius:50%;border:1.5px solid rgba(0,196,167,0.3);animation:ringPulse 2.4s ease-in-out infinite;}
    .splash-logo-ring:nth-child(2){inset:-20px;border-color:rgba(0,196,167,0.15);animation-delay:-0.6s;}
    .splash-logo-ring:nth-child(3){inset:-32px;border-color:rgba(0,196,167,0.07);animation-delay:-1.2s;}
    @keyframes ringPulse{0%,100%{transform:scale(0.92);opacity:0.4}50%{transform:scale(1.04);opacity:1}}
    .splash-logo-img{width:96px;height:96px;border-radius:24px;object-fit:cover;box-shadow:0 8px 32px rgba(0,196,167,0.35),0 2px 8px rgba(0,0,0,0.5);animation:logoFloat 3s ease-in-out infinite;}
    @keyframes logoFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
    .splash-title{font-size:2rem;font-weight:900;letter-spacing:-1px;background:linear-gradient(135deg,#fff 30%,var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:fadeSlideUp 0.8s ease 0.3s both;}
    .splash-sub{font-size:0.72rem;font-weight:600;color:var(--muted);letter-spacing:1.5px;margin-top:6px;animation:fadeSlideUp 0.8s ease 0.5s both;}
    .splash-status-text{margin-top:18px;font-size:0.6rem;font-weight:700;letter-spacing:2.5px;color:rgba(255,255,255,0.35);min-height:1em;animation:fadeSlideUp 0.8s ease 0.7s both;}
    @keyframes fadeSlideUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}

    /* â”€â”€â”€â”€â”€â”€ ë°°ê²½ â”€â”€â”€â”€â”€â”€ */
    .bg-ocean{position:fixed;inset:0;z-index:0;background:linear-gradient(180deg,#0d1f2d 0%,#0a3347 50%,#0a4f6e 100%);overflow:hidden;}
    .bg-wave{position:absolute;bottom:0;left:-50%;width:200%;height:180px;background:rgba(0,196,167,0.015);border-radius:50%;animation:bgWave 8s ease-in-out infinite;}
    .bg-wave:nth-child(2){height:130px;bottom:20px;animation-duration:11s;animation-delay:-3s;}
    .bg-wave:nth-child(3){height:100px;bottom:40px;animation-duration:14s;animation-delay:-6s;}
    @keyframes bgWave{0%,100%{transform:translateX(0)}50%{transform:translateX(-5%)}}

    .app{position:relative;z-index:1;width:100%;max-width:480px;margin:0 auto;height:100dvh;display:flex;flex-direction:column;overflow:hidden;}

    /* â”€â”€â”€â”€â”€â”€ í—¤ë”: ë¡œê³ /íƒ€ì´í‹€ ì¢Œ | ì‹œê³„+ìŒë ¥ ìš° â”€â”€â”€â”€â”€â”€ */
  /* í—¤ë” ì „ì²´ ë ˆì´ì•„ì›ƒ */
  .header {
    padding: 54px 20px 12px; /* ìƒë‹¨ ì—¬ë°±ì„ ì‚´ì§ ëŠ˜ë ¤ ì•ˆì •ê° ë¶€ì—¬ */
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    flex-shrink: 0;
  }

  /* ì™¼ìª½: ë¡œê³  + (ì´ë¦„/íƒ€ì´í‹€/ì„œë¸Œ) */
  .header-left {
    display: flex;
    align-items: center;
    gap: 14px; /* ë¡œê³ ì™€ í…ìŠ¤íŠ¸ ì‚¬ì´ ê°„ê²© ìµœì í™” */
  }

  /* ìºë¦­í„° ì´ë¦„í‘œ ìŠ¤íƒ€ì¼ (Lv.1 ì´ë¦„ ë‹˜) */
  #user-char-info {
    font-family: 'DM Mono', monospace;
    font-size: 0.58rem; /* ì‹œê³„ë³´ë‹¤ ì‘ê³  ê¹”ë”í•˜ê²Œ */
    font-weight: 700;
    color: var(--accent);
    letter-spacing: 0.8px;
    margin-bottom: 2px; /* ì‹œê³„ì™€ì˜ ê°„ê²© */
    opacity: 0.9;
  }

  .header-title {
    font-size: 1.25rem; /* ì‚´ì§ í‚¤ì›Œì„œ ì‹œì›í•˜ê²Œ */
    font-weight: 900;
    letter-spacing: -0.8px;
    line-height: 1.2;
  }

  .header-sub {
    font-size: 0.68rem;
    color: var(--muted);
    font-weight: 600;
    opacity: 0.8;
  }

  /* ìš°ì¸¡: ì‹œê³„ + ìŒë ¥ */
  .header-right {
    display: flex;
    flex-direction: column;
    align-items: flex-end; /* ì˜¤ë¥¸ìª½ ë ì •ë ¬ */
    gap: 2px; /* ê°„ê²©ì„ ì¢í˜€ì„œ í•˜ë‚˜ë¡œ ë¬¶ì¸ ëŠë‚Œ ë¶€ì—¬ */
    padding-top: 4px;
  }
    .clock {
    font-family: 'DM Mono', monospace;
    font-size: 1.1rem;
    font-weight: 500;
    color: #fff; /* ì‹œê³„ëŠ” ê¹”ë”í•˜ê²Œ í°ìƒ‰ìœ¼ë¡œ */
    letter-spacing: 1px;
    line-height: 1;
  }
    .lunar-display {
    font-size: 0.6rem;
    font-weight: 700;
    color: var(--muted);
    margin-top: 2px;
  }

    /* â”€â”€â”€â”€â”€â”€ ì»¨íŠ¸ë¡¤ ë°”: ê´€ì¸¡ì†Œ | ë‚ ì§œì´ë™ (50:50) â”€â”€â”€â”€â”€â”€ */
    .control-bar{
      padding:4px 20px 10px;
      display:flex;gap:8px;
      flex-shrink:0;
    }
    /* ê´€ì¸¡ì†Œ ë²„íŠ¼ */
    .location-btn{
      flex:1;
      display:flex;align-items:center;gap:6px;
      padding:9px 12px;border-radius:16px;
      border:1px solid rgba(255,255,255,0.15);
      background:rgba(255,255,255,0.07);
      color:#fff;font-size:0.78rem;font-weight:700;
      cursor:pointer;font-family:'Noto Sans KR',sans-serif;
      transition:all 0.2s;min-width:0;
    }
    .location-btn:active{transform:scale(0.97);}
    .location-btn-icon{font-size:0.9rem;flex-shrink:0;}
    .location-btn-text{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
    .location-btn-arrow{font-size:0.65rem;opacity:0.5;flex-shrink:0;}
    /* ë‚ ì§œì´ë™ ë²„íŠ¼ */
    .date-nav{
      flex:1;
      display:flex;align-items:center;
      border-radius:16px;
      border:1px solid rgba(255,255,255,0.15);
      background:rgba(255,255,255,0.07);
      overflow:hidden;min-width:0;
    }
    .date-nav-btn{
      width:34px;height:100%;flex-shrink:0;
      background:none;border:none;color:rgba(255,255,255,0.6);
      font-size:1rem;cursor:pointer;
      display:flex;align-items:center;justify-content:center;
      transition:all 0.15s;
    }
    .date-nav-btn:active{background:rgba(0,196,167,0.2);color:var(--accent);}
    .date-nav-center{
      flex:1;text-align:center;padding:9px 2px;
      cursor:pointer;min-width:0;
    }
    .date-nav-solar{
      font-family:'DM Mono',monospace;font-size:0.72rem;
      font-weight:500;color:#fff;white-space:nowrap;
    }
    .date-nav-label{
      font-size:0.55rem;font-weight:700;
      color:var(--accent);margin-top:1px;
    }

    /* â”€â”€â”€â”€â”€â”€ ì»¨í…ì¸  â”€â”€â”€â”€â”€â”€ */
    .content{flex:1;overflow-y:auto;padding:0 16px 20px;scrollbar-width:none;}
    .content::-webkit-scrollbar{display:none;}

    /* â”€â”€â”€â”€â”€â”€ ë‚ ì”¨ â”€â”€â”€â”€â”€â”€ */
    .weather-bar{display:none;align-items:center;gap:10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.08);border-radius:14px;padding:10px 14px;margin-bottom:10px;}
    .weather-bar.visible{display:flex;}
    .w-icon{font-size:1.3rem;}
    .w-text{flex:1;font-size:0.78rem;font-weight:700;}
    .w-sub{font-size:0.65rem;color:var(--muted);}
    .w-wind{font-family:'DM Mono',monospace;font-size:0.9rem;font-weight:500;color:var(--accent);}

    /* â”€â”€â”€â”€â”€â”€ ì˜ˆìƒìˆ˜ìœ„ ì¹´ë“œ (ì˜¤ëŠ˜ë§Œ í‘œì‹œ) â”€â”€â”€â”€â”€â”€ */
    .wave-card{
      border-radius:24px;overflow:hidden;
      border:1px solid rgba(255,255,255,0.1);
      margin-bottom:10px;position:relative;height:160px;
      background:rgba(255,255,255,0.05);
    }
    .wave-fill{
      position:absolute;bottom:0;left:0;right:0;
      background:linear-gradient(180deg,rgba(0,196,167,0.25),rgba(0,196,167,0.6));
      height:0%;transition:height 2.2s cubic-bezier(0.4,0,0.2,1);
    }
    .wave-fill::before{
      content:"";position:absolute;top:-18px;left:-50%;width:200%;height:36px;
      background:rgba(0,196,167,0.35);border-radius:50%;
      animation:waveTop 4s ease-in-out infinite;
    }
    @keyframes waveTop{0%,100%{transform:translateX(0)}50%{transform:translateX(-8%)}}
    .wave-info{
      position:absolute;inset:0;z-index:2;
      display:flex;align-items:center;justify-content:space-between;
      padding:20px 24px;
    }
    /* ë¬¼ë•Œ ë±ƒì§€ + ì„¤ëª… */
    .tide-badge-wrap{display:flex;flex-direction:column;gap:3px;margin-bottom:6px;}
    .tide-name-badge{display:inline-block;background:var(--accent);color:#0d1f2d;font-size:0.65rem;font-weight:900;padding:2px 10px;border-radius:20px;letter-spacing:0.5px;align-self:flex-start;}
    .tide-desc{font-size:0.6rem;font-weight:700;color:rgba(255,255,255,0.5);letter-spacing:0.2px;}
    .level-display{font-family:'DM Mono',monospace;font-size:3.2rem;font-weight:500;line-height:1;letter-spacing:-2px;}
    .level-unit{font-size:1rem;opacity:0.6;margin-left:3px;}
    .tide-status{font-size:0.72rem;font-weight:700;color:var(--accent);margin-top:4px;display:flex;align-items:center;gap:3px;}
    .wave-right{text-align:right;}
    .time-left-label{font-size:0.6rem;color:var(--muted);font-weight:700;margin-bottom:2px;}
    .time-left-val{font-family:'DM Mono',monospace;font-size:1rem;font-weight:500;color:#fff;}
    .station-name-display{font-size:0.65rem;color:var(--muted);font-weight:700;margin-top:8px;letter-spacing:0.5px;}

    /* â”€â”€â”€â”€â”€â”€ ìˆ˜ìœ„ ê²Œì´ì§€ â”€â”€â”€â”€â”€â”€ */
    .tide-gauge{position:absolute;right:20px;top:14px;bottom:14px;width:28px;z-index:3;display:flex;flex-direction:column;align-items:center;}
    .gauge-label-top{font-size:0.52rem;font-weight:700;line-height:1.2;text-align:center;color:rgba(255,255,255,0.7);}
    .gauge-label-top span{display:block;font-family:'DM Mono',monospace;font-size:0.6rem;color:var(--accent);}
    .gauge-bar{flex:1;width:4px;border-radius:2px;background:rgba(255,255,255,0.1);position:relative;margin:5px 0;}
    .gauge-bar-fill{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(180deg,rgba(0,196,167,0.5),var(--accent));border-radius:2px;transition:height 2.2s cubic-bezier(0.4,0,0.2,1);height:0%;}
    .gauge-tick{position:absolute;left:-4px;right:-4px;height:1px;background:rgba(255,255,255,0.3);}
    .gauge-dot{position:absolute;left:50%;transform:translateX(-50%);width:8px;height:8px;border-radius:50%;background:var(--accent);border:2px solid #0d1f2d;transition:bottom 2.2s cubic-bezier(0.4,0,0.2,1);box-shadow:0 0 6px rgba(0,196,167,0.6);}
    .gauge-label-bot{font-size:0.52rem;font-weight:700;line-height:1.2;text-align:center;color:rgba(255,255,255,0.7);}
    .gauge-label-bot span{display:block;font-family:'DM Mono',monospace;font-size:0.6rem;color:rgba(255,100,100,0.9);}

    /* â”€â”€â”€â”€â”€â”€ ë‚ ì§œ í—¤ë” (ì˜¤ëŠ˜ ì™¸) â”€â”€â”€â”€â”€â”€ */
    .date-only-header{
      display:none;
      padding:10px 4px 8px;
      font-size:0.65rem;font-weight:700;
      color:var(--muted);letter-spacing:1.5px;
    }

    /* â”€â”€â”€â”€â”€â”€ ì¡°ì„ ë¦¬ìŠ¤íŠ¸ â”€â”€â”€â”€â”€â”€ */
    .tide-item{
      display:flex;align-items:center;justify-content:space-between;
      padding:11px 14px;border-radius:14px;margin-bottom:7px;
      background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.06);
    }
    .tide-item.current{background:rgba(0,196,167,0.1);border-color:rgba(0,196,167,0.3);}
    .tide-item.dim{opacity:0.4;}
    .tide-item-left{display:flex;align-items:center;gap:10px;}
    .tide-icon{font-size:0.9rem;width:18px;text-align:center;}
    .tide-level-text{font-size:0.95rem;font-weight:800;font-family:'DM Mono',monospace;letter-spacing:-0.5px;}
    .tide-label{font-size:0.6rem;color:var(--muted);margin-top:1px;font-weight:600;}
    .tide-time{font-family:'DM Mono',monospace;font-size:0.9rem;font-weight:500;color:rgba(255,255,255,0.65);}
    .day-badge{font-size:0.55rem;background:rgba(255,255,255,0.1);color:var(--muted);padding:1px 5px;border-radius:5px;font-weight:700;margin-left:5px;vertical-align:middle;}

    /* â”€â”€â”€â”€â”€â”€ ë¡œë”© / ì—ëŸ¬ â”€â”€â”€â”€â”€â”€ */
    .loading{display:flex;flex-direction:column;align-items:center;justify-content:center;height:120px;gap:12px;color:var(--muted);}
    .loading-wave{display:flex;gap:5px;}
    .loading-dot{width:7px;height:7px;border-radius:50%;background:var(--accent);opacity:0.3;animation:loadPulse 1.2s ease-in-out infinite;}
    .loading-dot:nth-child(2){animation-delay:0.2s;}
    .loading-dot:nth-child(3){animation-delay:0.4s;}
    @keyframes loadPulse{0%,100%{opacity:0.3;transform:scale(1)}50%{opacity:1;transform:scale(1.3)}}
    .loading-text{font-size:0.72rem;font-weight:700;letter-spacing:1px;}
    .error-msg{text-align:center;padding:30px;color:var(--danger);font-size:0.82rem;font-weight:700;}

    /* â”€â”€â”€â”€â”€â”€ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ â”€â”€â”€â”€â”€â”€ */
    .refresh-btn{position:fixed;bottom:20px;right:20px;width:48px;height:48px;border-radius:50%;background:var(--accent);border:none;color:#0d1f2d;cursor:pointer;box-shadow:0 4px 18px rgba(0,196,167,0.4);display:flex;align-items:center;justify-content:center;transition:all 0.2s;z-index:100;}
    .refresh-btn:active{transform:scale(0.92);}
    .refresh-btn.spinning svg{animation:spin 0.8s linear;}
    @keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}

    .update-time{text-align:center;font-size:0.6rem;color:rgba(255,255,255,0.2);padding:6px;font-family:'DM Mono',monospace;}
    .empty-state{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;gap:12px;color:var(--muted);padding:40px;}
    .empty-icon{font-size:2.5rem;opacity:0.4;}
    .empty-text{font-size:0.82rem;font-weight:700;text-align:center;line-height:1.6;}

    /* â”€â”€â”€â”€â”€â”€ í‘¸í„° â”€â”€â”€â”€â”€â”€ */
    .footer-credit{text-align:center;padding:16px 20px 8px;border-top:1px solid rgba(255,255,255,0.06);margin-top:8px;}
    .credit-row{font-size:0.6rem;color:rgba(255,255,255,0.25);margin-bottom:4px;font-weight:600;}
    .credit-row a{color:rgba(255,255,255,0.3);text-decoration:none;}
    .credit-row a:hover{color:var(--accent);}
    .credit-divider{height:1px;background:rgba(255,255,255,0.06);margin:8px 0;}
    .credit-maker{color:rgba(255,255,255,0.35)!important;font-weight:700!important;}

    /* â”€â”€â”€â”€â”€â”€ ê´€ì¸¡ì†Œ ì‹œíŠ¸ â”€â”€â”€â”€â”€â”€ */
    .sheet-overlay{position:fixed;inset:0;z-index:200;background:rgba(0,0,0,0.5);opacity:0;pointer-events:none;transition:opacity 0.3s;}
    .sheet-overlay.open{opacity:1;pointer-events:auto;}
    .sheet{position:fixed;bottom:0;left:0;right:0;z-index:201;max-width:480px;margin:0 auto;background:#0f2535;border-radius:24px 24px 0 0;border-top:1px solid rgba(255,255,255,0.1);transform:translateY(100%);transition:transform 0.35s cubic-bezier(0.4,0,0.2,1);padding-bottom:env(safe-area-inset-bottom);}
    .sheet.open{transform:translateY(0);}
    .sheet-handle{width:36px;height:4px;border-radius:2px;background:rgba(255,255,255,0.2);margin:12px auto 0;}
    .sheet-step{padding:16px 20px 24px;}
    .sheet-title{font-size:0.65rem;font-weight:700;letter-spacing:2px;color:var(--muted);text-transform:uppercase;margin-bottom:14px;}
    .region-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
    .region-item{display:flex;align-items:center;gap:10px;padding:14px 16px;border-radius:16px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);cursor:pointer;transition:all 0.2s;}
    .region-item:active{transform:scale(0.97);}
    .region-item.active{background:rgba(0,196,167,0.15);border-color:var(--accent);}
    .region-emoji{font-size:1.4rem;}
    .region-label{font-size:0.9rem;font-weight:900;}
    .region-count{font-size:0.6rem;color:var(--muted);font-weight:600;margin-top:1px;}
    .sheet-back{display:flex;align-items:center;gap:6px;font-size:0.72rem;font-weight:700;color:var(--muted);cursor:pointer;margin-bottom:14px;background:none;border:none;padding:0;font-family:'Noto Sans KR',sans-serif;}
    .station-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;}
    .station-item{display:flex;flex-direction:column;align-items:center;gap:4px;padding:12px 8px;border-radius:14px;border:1px solid rgba(255,255,255,0.08);background:rgba(255,255,255,0.04);cursor:pointer;transition:all 0.2s;text-align:center;}
    .station-item:active{transform:scale(0.95);}
    .station-item.active{background:rgba(0,196,167,0.15);border-color:var(--accent);}
    .station-item-emoji{font-size:1.1rem;}
    .station-item-name{font-size:0.72rem;font-weight:700;color:rgba(255,255,255,0.85);}
    .station-item.active .station-item-name{color:var(--accent);}
  .cal-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;}
  .cal-month-label{font-size:0.95rem;font-weight:900;}
  .cal-nav-btn{background:none;border:none;color:rgba(255,255,255,0.6);font-size:1.2rem;cursor:pointer;padding:4px 10px;}
  .cal-nav-btn:active{color:var(--accent);}
  .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;text-align:center;}
  .cal-day-label{font-size:0.6rem;font-weight:700;color:var(--muted);padding:4px 0;}
  .cal-day{padding:8px 4px;border-radius:10px;font-size:0.82rem;font-weight:700;cursor:pointer;color:rgba(255,255,255,0.7);transition:all 0.15s;}
  .cal-day:active{transform:scale(0.93);}
  .cal-day.today{border:1px solid var(--accent);color:var(--accent);}
  .cal-day.selected{background:var(--accent);color:#0d1f2d;}
  .cal-day.other-month{opacity:0.25;}
  .cal-day.sunday{color:#ff6b6b;}
  .cal-day.saturday{color:#5ba4f5;}
  .cal-day.selected.sunday,.cal-day.selected.saturday{color:#0d1f2d;}
  .cal-today-btn{width:100%;margin-top:14px;padding:11px;border-radius:14px;background:rgba(0,196,167,0.15);border:1px solid rgba(0,196,167,0.4);color:var(--accent);font-size:0.82rem;font-weight:700;cursor:pointer;font-family:'Noto Sans KR',sans-serif;transition:all 0.2s;}
  .cal-today-btn:active{background:rgba(0,196,167,0.3);}
  /* ìºë¦­í„° ë“±ë¡ íŒì—… ìŠ¤íƒ€ì¼ */
  .char-modal {
    position: fixed; inset: 0; z-index: 10000;
    background: rgba(13, 31, 45, 0.95);
    display: flex; align-items: center; justify-content: center;
    padding: 20px;
  }
  .char-modal-content {
    background: #1a3a4a; padding: 30px; border-radius: 24px;
    width: 100%; max-width: 320px; text-align: center;
    border: 1px solid var(--accent);
  }
  .char-input {
    width: 100%; padding: 12px; border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.2);
    background: rgba(255,255,255,0.05); color: #fff;
    margin: 20px 0; font-size: 1rem; text-align: center;
  }
  .char-btn {
    width: 100%; padding: 12px; border-radius: 12px;
    background: var(--accent); color: #0d1f2d;
    border: none; font-weight: 700; cursor: pointer;
  }
  </style>
  </head>
  <body>

  <!-- ìŠ¤í”Œë˜ì‹œ -->
  <div class="splash" id="splash">
    <div class="splash-stars" id="splash-stars"></div>
    <div class="splash-water" id="splash-water">
      <div class="splash-water-body"><div class="splash-water-shimmer"></div></div>
    </div>
    <div class="splash-content">
      <div class="splash-logo-wrap">
        <div class="splash-logo-ring"></div>
        <div class="splash-logo-ring"></div>
        <div class="splash-logo-ring"></div>
        <img class="splash-logo-img" src="https://raw.githubusercontent.com/gujwatourjeju-collab/seatime/main/logo.png" alt="ë°”ë‹¹ë•Œ">
      </div>
      <div class="splash-title">ë°”ë‹¹ë•Œ</div>
      <div class="splash-sub">ë°”ë‹¤ ì•ì— ì„œê¸° ì „, ë°”ë‹¹ë•Œ ë¨¼ì €</div>
      <div class="splash-status-text" id="splash-status-text"></div>
    </div>
  </div>

  <div class="bg-ocean">
    <div class="bg-wave"></div><div class="bg-wave"></div><div class="bg-wave"></div>
  </div>

  <div class="app">

    <!-- â”€â”€ í—¤ë”: ë¡œê³  ì¢Œ | ì‹œê³„+ìŒë ¥ ìš° â”€â”€ -->
    <div class="header">
    <div class="header-left">
      <img src="https://raw.githubusercontent.com/gujwatourjeju-collab/seatime/main/logo.png" 
          style="width:38px; height:38px; border-radius:10px; object-fit:cover;">
      <div>
        <div class="header-title">ë°”ë‹¹ë•Œ</div>
        <div class="header-sub">ë°”ë‹¤ ì•ì— ì„œê¸° ì „, ë°”ë‹¹ë•Œ ë¨¼ì €</div>
      </div>
    </div>

    <div class="header-right">
      <div id="user-char-info"></div> <div class="clock" id="clock">--:--:--</div>
      <div id="lunar-display" class="lunar-display">ìŒë ¥ --ì›” --ì¼ (-)</div>
    </div>
  </div>

    <!-- â”€â”€ ì»¨íŠ¸ë¡¤ ë°”: ê´€ì¸¡ì†Œ | ë‚ ì§œì´ë™ â”€â”€ -->
    <div class="control-bar">
      <!-- ê´€ì¸¡ì†Œ ì„ íƒ (50%) -->
      <div class="location-btn" onclick="openSheet()">
        <span class="location-btn-icon" id="loc-icon">ğŸ“</span>
        <span class="location-btn-text" id="loc-text">ê´€ì¸¡ì†Œ ì„ íƒ</span>
        <span class="location-btn-arrow">â–¼</span>
      </div>
      <!-- ë‚ ì§œì´ë™ (50%) -->
      <div class="date-nav">
        <button class="date-nav-btn" onclick="shiftDate(-1)">â€¹</button>
        <div class="date-nav-center" onclick="openCalendar()">
          <div class="date-nav-solar" id="date-nav-solar">--/--</div>
          <div class="date-nav-label" id="date-nav-label">ì˜¤ëŠ˜</div>
        </div>
        <button class="date-nav-btn" onclick="shiftDate(+1)">â€º</button>
      </div>
    </div>

    <div class="content">

      <!-- ë‚ ì”¨ -->
      <div class="weather-bar" id="weather-bar">
        <div class="w-icon" id="w-icon">ğŸŒ¤</div>
        <div>
          <div class="w-text" id="w-main">--</div>
          <div class="w-sub" id="w-detail">ë°”ë‹¤ ë‚ ì”¨</div>
        </div>
        <div class="w-wind" id="w-wind">--</div>
      </div>

      <!-- ì˜ˆìƒìˆ˜ìœ„ ì¹´ë“œ (ì˜¤ëŠ˜ë§Œ) -->
      <div class="wave-card" id="wave-card" style="display:none;">
        <div class="wave-fill" id="wave-fill"></div>
        <div class="wave-info" style="padding-right:56px;">
          <div>
            <div class="tide-badge-wrap">
              <div class="tide-name-badge" id="tide-name" style="display:none;"></div>
              <div class="tide-desc" id="tide-desc"></div>
            </div>
            <div class="level-display"><span id="level-num">--</span><span class="level-unit">cm</span></div>
            <div class="tide-status" id="tide-status"></div>
          </div>
          <div class="wave-right">
            <div class="time-left-label">ë‹¤ìŒ ë¬¼ë•Œê¹Œì§€</div>
            <div class="time-left-val" id="time-left">--</div>
            <div class="station-name-display" id="station-display"></div>
          </div>
        </div>
        <div class="tide-gauge">
          <div class="gauge-label-top" id="gauge-top-label">--<span id="gauge-top-val">--</span></div>
          <div class="gauge-bar">
            <div class="gauge-bar-fill" id="gauge-fill"></div>
            <div class="gauge-tick" style="top:50%;"></div>
            <div class="gauge-dot" id="gauge-dot"></div>
          </div>
          <div class="gauge-label-bot" id="gauge-bot-label">--<span id="gauge-bot-val">--</span></div>
        </div>
      </div>

      <!-- ì¡°ì„ ë¦¬ìŠ¤íŠ¸ -->
      <div id="tide-list">
        <div class="empty-state">
          <div class="empty-icon">ğŸŒŠ</div>
          <div class="empty-text">ìœ„ ë²„íŠ¼ì„ ëˆŒëŸ¬<br>ê´€ì¸¡ì†Œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</div>
        </div>
      </div>

      <div class="update-time" id="update-time"></div>

      <div class="footer-credit">
        <div class="credit-row">ì¡°ì„ ë°ì´í„° Â· <a href="https://www.khoa.go.kr" target="_blank">êµ­ë¦½í•´ì–‘ì¡°ì‚¬ì› KHOA</a></div>
        <div class="credit-divider"></div>
        <div class="credit-row credit-maker">Made by Boungje Min</div>
      </div>
    </div>
  </div>

  <!-- ê´€ì¸¡ì†Œ ì‹œíŠ¸ -->
  <div class="sheet-overlay" id="sheet-overlay" onclick="closeSheet()"></div>
  <div class="sheet" id="sheet">
    <div class="sheet-handle"></div>
    <div class="sheet-step" id="step-region">
      <div class="sheet-title">ì§€ì—­ ì„ íƒ</div>
      <div class="region-grid">
        <div class="region-item" onclick="selectRegion('jeju')">
          <span class="region-emoji">ğŸ</span>
          <div><div class="region-label">ì œì£¼</div><div class="region-count">6ê°œ ê´€ì¸¡ì†Œ</div></div>
        </div>
        <div class="region-item" onclick="selectRegion('west')">
          <span class="region-emoji">ğŸŒŠ</span>
          <div><div class="region-label">ì„œí•´</div><div class="region-count">17ê°œ ê´€ì¸¡ì†Œ</div></div>
        </div>
        <div class="region-item" onclick="selectRegion('south')">
          <span class="region-emoji">ğŸ¬</span>
          <div><div class="region-label">ë‚¨í•´</div><div class="region-count">5ê°œ ê´€ì¸¡ì†Œ</div></div>
        </div>
        <div class="region-item" onclick="selectRegion('east')">
          <span class="region-emoji">ğŸ”</span>
          <div><div class="region-label">ë™í•´</div><div class="region-count">3ê°œ ê´€ì¸¡ì†Œ</div></div>
        </div>
      </div>
    </div>
    <div class="sheet-step" id="step-station" style="display:none;">
      <button class="sheet-back" onclick="backToRegion()">â† ì§€ì—­ ë‹¤ì‹œ ì„ íƒ</button>
      <div class="sheet-title" id="step-station-title">ê´€ì¸¡ì†Œ ì„ íƒ</div>
      <div class="station-grid" id="station-grid"></div>
    </div>
  </div>
  <!-- ë‹¬ë ¥ ì‹œíŠ¸ -->
  <div class="sheet-overlay" id="cal-overlay" onclick="closeCalendar()"></div>
  <div class="sheet" id="cal-sheet" onclick="event.stopPropagation()">
    <div class="sheet-handle"></div>
    <div class="sheet-step">
      <div class="cal-header">
        <button class="cal-nav-btn" onclick="calShiftMonth(-1)">â€¹</button>
        <div class="cal-month-label" id="cal-month-label"></div>
        <button class="cal-nav-btn" onclick="calShiftMonth(+1)">â€º</button>
      </div>
      <div class="cal-grid" id="cal-grid"></div>
      <button class="cal-today-btn" onclick="calGoToday()">ì˜¤ëŠ˜ë¡œ ëŒì•„ê°€ê¸°</button>
    </div>
  </div>
  <button class="refresh-btn" id="refresh-btn" onclick="refresh()">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="23 4 23 10 17 10"></polyline>
      <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
    </svg>
  </button>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    // ğŸŒŠ Supabase ì—°ê²° ì •ë³´
    const SUPABASE_URL = 'https://raykkfvchlfsjtlkbpji.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_HV81jL04Eq8m52cMm-LhSw_FX9pSikn';
    
    // ğŸŒŸ ì˜¤íƒ€ ìˆ˜ì •: selectorsupabase -> supabase (ì´ê²Œ í•µì‹¬!)
    // ì—¬ê¸°ì„œ 'supabase'ë¼ëŠ” ì´ë¦„ì˜ ì¡°ì¢…ê¸°ë¥¼ ë§Œë“œëŠ” ê±°ì•¼.
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const GAS_URL = 'https://script.google.com/macros/s/AKfycbx4YNUSBd41ky1T07NqfHLwEB8nthaDVs16iEFkPSVFVYmCznwPHVyyxrm2BeWGfPtfIA/exec';

    const STATIONS = {
    'ê¹€ë…•':    {type:'blend', obs1:'DT_0004',obs2:'DT_0022',w1:0.48,w2:0.52,timeCorr:+10,lat:33.558, lng:126.751,region:'jeju'},
    'ì œì£¼':    {type:'single',obs:'DT_0004', lat:33.5275,lng:126.543, region:'jeju'},
    'ì„±ì‚°í¬':  {type:'single',obs:'DT_0022', lat:33.4747,lng:126.927, region:'jeju'},
    'ì„œê·€í¬':  {type:'single',obs:'DT_0061', lat:33.2468,lng:126.561, region:'jeju'},
    'ëª¨ìŠ¬í¬':  {type:'single',obs:'DT_0020', lat:33.2147,lng:126.251, region:'jeju'},
    'ì¶”ìë„':  {type:'single',obs:'DT_0021', lat:33.9611,lng:126.889, region:'jeju'},
    'ë§ŒëŒ€í•­':  {type:'scale', obs:'DT_0050', scale:1.10,timeCorr:+3,lat:36.626, lng:126.309,region:'west'},
    'íƒœì•ˆ':    {type:'single',obs:'DT_0050', lat:36.7445,lng:126.297, region:'west'},
    'ì•ˆí¥':    {type:'single',obs:'DT_0067', lat:36.6747,lng:126.115, region:'west'},
    'ë³´ë ¹':    {type:'single',obs:'DT_0025', lat:36.4167,lng:126.483, region:'west'},
    'ì„œì²œë§ˆëŸ‰':{type:'single',obs:'DT_0051', lat:36.0833,lng:126.633, region:'west'},
    'êµ°ì‚°':    {type:'single',obs:'DT_0018', lat:35.9833,lng:126.717, region:'west'},
    'ìœ„ë„':    {type:'single',obs:'DT_0068', lat:35.6167,lng:126.300, region:'west'},
    'ì–´ì²­ë„':  {type:'single',obs:'DT_0037', lat:36.1167,lng:125.983, region:'west'},
    'í‘ì‚°ë„':  {type:'single',obs:'DT_0035', lat:34.6833,lng:125.433, region:'west'},
    'í–¥í™”ë„':  {type:'single',obs:'DT_0066', lat:35.8833,lng:126.517, region:'west'},
    'ì¸ì²œì†¡ë„':{type:'single',obs:'DT_0052', lat:37.3833,lng:126.633, region:'west'},
    'ê°•í™”ëŒ€êµ':{type:'single',obs:'DT_0032', lat:37.7333,lng:126.533, region:'west'},
    'ë•ì ë„':  {type:'single',obs:'DT_0065', lat:37.2333,lng:126.133, region:'west'},
    'êµ´ì—…ë„':  {type:'single',obs:'DT_0038', lat:37.1833,lng:126.250, region:'west'},
    'ëŒ€ì²­ë„':  {type:'single',obs:'DT_0036', lat:37.8333,lng:124.717, region:'west'},
    'ì—°í‰ë„':  {type:'single',obs:'DT_0060', lat:37.6667,lng:125.683, region:'west'},
    'ì¥í•­':    {type:'single',obs:'DT_0024', lat:36.0000,lng:126.700, region:'west'},
    'í†µì˜':    {type:'single',obs:'DT_0014', lat:34.8500,lng:128.433, region:'south'},
    'ê±°ë¬¸ë„':  {type:'single',obs:'DT_0031', lat:34.0167,lng:127.300, region:'south'},
    'ë§ˆì‚°':    {type:'single',obs:'DT_0062', lat:35.2000,lng:128.567, region:'south'},
    'ê°€ë•ë„':  {type:'single',obs:'DT_0063', lat:35.0167,lng:128.817, region:'south'},
    'ì§„í•´':    {type:'single',obs:'DT_0054', lat:35.1000,lng:128.700, region:'south'},
    'ì†ì´ˆ':    {type:'single',obs:'DT_0012', lat:38.2000,lng:128.600, region:'east'},
    'í›„í¬':    {type:'single',obs:'DT_0011', lat:36.6833,lng:129.450, region:'east'},
    'ìš¸ë¦‰ë„':  {type:'single',obs:'DT_0013', lat:37.5000,lng:130.900, region:'east'},
  };
  const REGION_INFO = {
    jeju:{label:'ì œì£¼',emoji:'ğŸ'}, west:{label:'ì„œí•´',emoji:'ğŸŒŠ'},
    south:{label:'ë‚¨í•´',emoji:'ğŸ¬'}, east:{label:'ë™í•´',emoji:'ğŸ”'}
  };
  const EMOJI = {
    ê¹€ë…•:'ğŸ„',ì œì£¼:'ğŸŒŠ',ì„±ì‚°í¬:'ğŸŒ…',ì„œê·€í¬:'ğŸ¬',ëª¨ìŠ¬í¬:'âš“',ì¶”ìë„:'ğŸ”',
    ë§ŒëŒ€í•­:'ğŸ¦€',íƒœì•ˆ:'ğŸŒ¾',ì•ˆí¥:'â›µ',ë³´ë ¹:'ğŸ–',ì„œì²œë§ˆëŸ‰:'ğŸ£',êµ°ì‚°:'ğŸŒ‰',
    ìœ„ë„:'ğŸ',ì–´ì²­ë„:'âš“',í‘ì‚°ë„:'ğŸŒ‘',í–¥í™”ë„:'ğŸŒ¿',ì¸ì²œì†¡ë„:'ğŸ™',ê°•í™”ëŒ€êµ:'ğŸŒ',
    ë•ì ë„:'ğŸ”',êµ´ì—…ë„:'ğŸ¦…',ëŒ€ì²­ë„:'ğŸ”µ',ì—°í‰ë„:'ğŸŸ¡',ì¥í•­:'ğŸŒŠ',
    í†µì˜:'ğŸ¦ª',ê±°ë¬¸ë„:'ğŸ',ë§ˆì‚°:'ğŸŸ',ê°€ë•ë„:'âš“',ì§„í•´:'ğŸŒ¸',
    ì†ì´ˆ:'ğŸŒŠ',í›„í¬:'ğŸ£',ìš¸ë¦‰ë„:'ğŸŒ‹',
  };
  const TIDE_DESC = {
    '1ë¬¼':'ê°„ì¡°Â·ë§Œì¡° ì°¨ê°€ ì»¤ì§€ê¸° ì‹œì‘í•´ìš”','2ë¬¼':'ë¬¼ì‚´ì´ ì¡°ê¸ˆì”© ë¹¨ë¼ì ¸ìš”',
    '3ë¬¼':'ì¡°ë¥˜ê°€ í™œë°œí•´ì§€ëŠ” ë‚ ì´ì—ìš”','4ë¬¼':'ë¬¼ì´ ì œë²• ë§ì´ ë“¤ê³  ë‚˜ìš”',
    '5ë¬¼':'ë¬¼ì‚´ì´ ì ì  ì„¸ì ¸ìš”','6ë¬¼':'ì‚¬ë¦¬ ì´í‹€ ì „, ì¡°ë¥˜ ê°•í•´ìš”',
    '7ë¬¼':'ì‚¬ë¦¬ ì „ë‚ , ì¡°ë¥˜ ì£¼ì˜í•˜ì„¸ìš”','8ë¬¼':'ì‚¬ë¦¬! ë¬¼ì´ ê°€ì¥ ë§ì´ ë“¤ì–´ìš”',
    '9ë¬¼':'ë¬¼ì‚´ì´ ì¡°ê¸ˆì”© ì•ˆì •ë¼ìš”','10ë¬¼':'ê°„ì¡°Â·ë§Œì¡° ì°¨ ì¤„ì–´ë“¤ê³  ìˆì–´ìš”',
    '11ë¬¼':'ê°¯ë²Œì´ ë„“ê²Œ ë“œëŸ¬ë‚˜ìš”','12ë¬¼':'ë¬¼ì´ ë§ì´ ë¹ ì§€ëŠ” ë‚ ì´ì—ìš”',
    '13ë¬¼':'ì¡°ë¥˜ê°€ ì ì  ì ì í•´ì ¸ìš”','14ë¬¼':'ì¡°ê¸ˆ ì „ë‚ , ë¬¼ì‚´ ê±°ì˜ ì—†ì–´ìš”',
    'ì¡°ê¸ˆ':'ë¬¼ì´ ê°€ì¥ ì ê²Œ ë“¤ê³ ë‚˜ìš”','ë¬´ì‹œ':'ë¬¼ë•Œ ì „í™˜ê¸°, ì¡°ë¥˜ ì•½í•´ìš”',
  };
  const WEEKDAYS = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
  const MONTHS_KR = ['1','2','3','4','5','6','7','8','9','10','11','12'];

  let currentStation = null;
  let selectedDateOffset = 0; // 0=ì˜¤ëŠ˜

  /* â”€â”€ ìŒë ¥ ê³„ì‚° (ì‚­ ë‚ ì§œ í…Œì´ë¸” ê¸°ë°˜ - ì •í™•) â”€â”€ */
  // í•œêµ­ì²œë¬¸ì—°êµ¬ì› ê¸°ì¤€ ì‚­(ì´ˆí•˜ë£¨) ë‚ ì§œ ëª©ë¡
  // [ì–‘ë ¥ Date, ìŒë ¥ ì›”]
  const SAK_TABLE = [
    // 2025ë…„
    [new Date(2025,0,29),  1],   // ìŒë ¥ 1ì›” 1ì¼
    [new Date(2025,1,28),  2],
    [new Date(2025,2,29),  3],
    [new Date(2025,3,27),  4],
    [new Date(2025,4,27),  'ìœ¤4'], 
    [new Date(2025,5,25),  5],
    [new Date(2025,6,25),  6],
    [new Date(2025,7,23),  7],
    [new Date(2025,8,21),  8],
    [new Date(2025,9,21),  9],
    [new Date(2025,10,20), 10],
    [new Date(2025,11,20), 11],
    [new Date(2026,0,19),  12],
    
    // ğŸŒŸ 2026ë…„ (ë²”ì¸ ê²€ê±° ë° ìˆ˜ì • ì™„ë£Œ)
    [new Date(2026,1,17),  1],   // 2ì›” 17ì¼ = ìŒë ¥ 1.1
    [new Date(2026,2,19),  2],   // ğŸŒŸ 3ì›” 19ì¼ = ìŒë ¥ 2.1 (ì´ê²Œ 18ì¼ë¡œ ë˜ì–´ìˆì—ˆìŒ!)
    [new Date(2026,3,17),  3],   // 4ì›” 17ì¼ = ìŒë ¥ 3.1
    [new Date(2026,4,16),  4],   // 5ì›” 16ì¼ = ìŒë ¥ 4.1
    [new Date(2026,5,15),  5],   // 6ì›” 15ì¼ = ìŒë ¥ 5.1
    [new Date(2026,6,14),  6],   // 7ì›” 14ì¼ = ìŒë ¥ 6.1
    [new Date(2026,7,13),  7],
    [new Date(2026,8,11),  8],
    [new Date(2026,9,11),  9],
    [new Date(2026,10,10), 10],
    [new Date(2026,11,9),  11],
    [new Date(2027,0,8),   12],
    
    // 2027ë…„
    [new Date(2027,1,6),   1],
    [new Date(2027,2,8),   2],
    [new Date(2027,3,6),   3],
    [new Date(2027,4,6),   4],
    [new Date(2027,5,4),   5],
  ];
  function getLunarInfo(date) {
    const d = new Date(date); d.setHours(0,0,0,0);
    let found = -1;
    for (let i = SAK_TABLE.length-1; i >= 0; i--) {
      if (SAK_TABLE[i][0] <= d) { found = i; break; }
    }
    if (found < 0) {
      // í…Œì´ë¸” ë²”ìœ„ ë°–ì´ë©´ ê·¼ì‚¬ê°’ìœ¼ë¡œ fallback
      const BASE = new Date(2000,1,5);
      const LUNAR_MONTH = 29.530588;
      const diff = Math.floor((d - BASE) / 86400000);
      const mo = Math.floor(diff / LUNAR_MONTH);
      const day = ((diff - Math.round(mo * LUNAR_MONTH)) % 30 + 30) % 30 + 1;
      return { month: (mo % 12) + 1, day };
    }
    const sakDate = SAK_TABLE[found][0];
    const month = SAK_TABLE[found][1];
    const day = Math.floor((d - sakDate) / 86400000) + 1;
    return { month, day };
  }
  function getLunarDay(date)   { return getLunarInfo(date).day; }
  function getLunarMonth(date) { return getLunarInfo(date).month; }

  function getTideName(lunarDay, region) {
    if (region === 'west') {
      // ğŸŒŠ ì„œí•´ (7ë¬¼ë•Œ): 14ë¬¼ì´ ì—†ê³  13ë¬¼ ë‹¤ìŒ ë°”ë¡œ 'ì¡°ê¸ˆ(8/23)' -> 'ë¬´ì‹œ(9/24)' -> '1ë¬¼(10/25)'
      const westNames = {
        1:'7ë¬¼', 2:'8ë¬¼', 3:'9ë¬¼', 4:'10ë¬¼', 5:'11ë¬¼', 6:'12ë¬¼', 7:'13ë¬¼',
        8:'ì¡°ê¸ˆ', 9:'ë¬´ì‹œ', 10:'1ë¬¼', 11:'2ë¬¼', 12:'3ë¬¼', 13:'4ë¬¼', 14:'5ë¬¼', 15:'6ë¬¼',
        16:'7ë¬¼', 17:'8ë¬¼', 18:'9ë¬¼', 19:'10ë¬¼', 20:'11ë¬¼', 21:'12ë¬¼', 22:'13ë¬¼',
        23:'ì¡°ê¸ˆ', 24:'ë¬´ì‹œ', 25:'1ë¬¼', 26:'2ë¬¼', 27:'3ë¬¼', 28:'4ë¬¼', 29:'5ë¬¼', 30:'6ë¬¼'
      };
      return westNames[lunarDay] || '';
    } else {
      // ğŸï¸ ì œì£¼/ë‚¨í•´/ë™í•´ (8ë¬¼ë•Œ): ë¬´ì‹œê°€ ì—†ê³  'ì¡°ê¸ˆ(8/23)' ë‹¤ìŒ ë°”ë¡œ '1ë¬¼(9/24)'
      const eastSouthNames = {
        1:'8ë¬¼', 2:'9ë¬¼', 3:'10ë¬¼', 4:'11ë¬¼', 5:'12ë¬¼', 6:'13ë¬¼', 7:'14ë¬¼',
        8:'ì¡°ê¸ˆ', 9:'1ë¬¼', 10:'2ë¬¼', 11:'3ë¬¼', 12:'4ë¬¼', 13:'5ë¬¼', 14:'6ë¬¼', 15:'7ë¬¼',
        16:'8ë¬¼', 17:'9ë¬¼', 18:'10ë¬¼', 19:'11ë¬¼', 20:'12ë¬¼', 21:'13ë¬¼', 22:'14ë¬¼',
        23:'ì¡°ê¸ˆ', 24:'1ë¬¼', 25:'2ë¬¼', 26:'3ë¬¼', 27:'4ë¬¼', 28:'5ë¬¼', 29:'6ë¬¼', 30:'7ë¬¼'
      };
      return eastSouthNames[lunarDay] || '';
    }
  }
  /* â”€â”€ ë‚ ì§œ ìœ í‹¸ â”€â”€ */
  function getOffsetDate(offset) {
    const d = new Date(); d.setHours(0,0,0,0);
    d.setDate(d.getDate()+offset); return d;
  }
  function dateToStr(d) {
    // YYYYMMDD
    return d.getFullYear()+
      String(d.getMonth()+1).padStart(2,'0')+
      String(d.getDate()).padStart(2,'0');
  }

  /* â”€â”€ í—¤ë” ìŒë ¥ ì—…ë°ì´íŠ¸ â”€â”€ */
  function updateLunarDisplay() {
    const d = getOffsetDate(selectedDateOffset);
    const lDay   = getLunarDay(d);
    const lMonth = getLunarMonth(d);
    const wd = WEEKDAYS[d.getDay()];
    const monthStr = typeof lMonth === 'string' ? lMonth : lMonth+'ì›”';
    document.getElementById('lunar-display').textContent =
      `ìŒë ¥ ${monthStr} ${lDay}ì¼ (${wd})`;
  }

  /* â”€â”€ ë‚ ì§œì´ë™ ë²„íŠ¼ í‘œì‹œ ì—…ë°ì´íŠ¸ â”€â”€ */
  function updateDateNav() {
    const d = getOffsetDate(selectedDateOffset);
    const solar = `${d.getMonth()+1}/${d.getDate()}`;
    document.getElementById('date-nav-solar').textContent = solar;
    document.getElementById('date-nav-label').textContent =
      selectedDateOffset === 0 ? 'ì˜¤ëŠ˜' :
      selectedDateOffset > 0  ? `+${selectedDateOffset}ì¼` : `${selectedDateOffset}ì¼`;
  }

  /* â”€â”€ ì‹œê³„ â”€â”€ */
  function updateClock() {
    const n = new Date();
    document.getElementById('clock').textContent =
      String(n.getHours()).padStart(2,'0')+':'+
      String(n.getMinutes()).padStart(2,'0')+':'+
      String(n.getSeconds()).padStart(2,'0');
  }
  setInterval(updateClock,1000); updateClock();

  /* â”€â”€ ë‚ ì§œ ì´ë™ â”€â”€ */
  function shiftDate(delta) {
    selectedDateOffset += delta;
    updateLunarDisplay();
    updateDateNav();
    if (currentStation) loadTide(currentStation);
  }
  function goToday() {
    if (selectedDateOffset === 0) return;
    selectedDateOffset = 0;
    updateLunarDisplay();
    updateDateNav();
    if (currentStation) loadTide(currentStation);
  }

  /* â”€â”€ ê´€ì¸¡ì†Œ ì‹œíŠ¸ â”€â”€ */
  function openSheet() {
    document.getElementById('sheet-overlay').classList.add('open');
    document.getElementById('sheet').classList.add('open');
    showRegionStep();
  }
  function closeSheet() {
    document.getElementById('sheet-overlay').classList.remove('open');
    document.getElementById('sheet').classList.remove('open');
  }
  function showRegionStep() {
    document.getElementById('step-region').style.display='block';
    document.getElementById('step-station').style.display='none';
    document.querySelectorAll('.region-item').forEach(el=>{
      const r=el.getAttribute('onclick').match(/'(\w+)'/)?.[1];
      el.classList.toggle('active',currentStation&&STATIONS[currentStation]?.region===r);
    });
  }
  function backToRegion(){showRegionStep();}
  function selectRegion(region){
    document.getElementById('step-region').style.display='none';
    document.getElementById('step-station').style.display='block';
    const info=REGION_INFO[region];
    document.getElementById('step-station-title').textContent=`${info.emoji} ${info.label} ê´€ì¸¡ì†Œ`;
    const names=Object.keys(STATIONS).filter(k=>STATIONS[k].region===region);
    document.getElementById('station-grid').innerHTML=names.map(name=>`
      <div class="station-item ${currentStation===name?'active':''}" onclick="pickStation('${name}')">
        <span class="station-item-emoji">${EMOJI[name]||'ğŸ“'}</span>
        <span class="station-item-name">${name}</span>
      </div>`).join('');
  }
  function pickStation(name){closeSheet();selectStation(name);}

  async function selectStation(name){
    currentStation=name;
    localStorage.setItem('lastStation',name);
    const region=STATIONS[name].region, rInfo=REGION_INFO[region];
    document.getElementById('loc-icon').textContent=EMOJI[name]||'ğŸ“';
    document.getElementById('loc-text').textContent=`${rInfo.label} Â· ${name}`;
    const s=STATIONS[name];
    await Promise.all([loadTide(name),loadWeather(s.lat,s.lng)]);
  }

  /* â”€â”€ GAS í˜¸ì¶œ (ë‚ ì§œ íŒŒë¼ë¯¸í„° í¬í•¨) â”€â”€ */
  // ğŸš€ êµ¬ê¸€(GAS) ëŒ€ì‹  Supabase ì—”ì§„ì„ ë¶€ë¥´ëŠ” ìƒˆ í•¨ìˆ˜ì…ë‹ˆë‹¤!
  // 1. ë°ì´í„° ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ (ì„œë²„ ì‘ë‹µ êµ¬ì¡°ì— ë§ì¶¤)
async function getTideData(obsCode, date) {
  try {
    const isToday = (date === dateToStr(getOffsetDate(0))) // âœ… ì˜¤ëŠ˜ì¸ì§€ íŒë³„
    const { data, error } = await supabaseClient.functions.invoke('get-tide-data', {
      body: { obsCode, date, isToday }, // âœ… isToday ì¶”ê°€
      headers: { 'Content-Type': 'application/json' }
    });
    if (error) { console.error("ì„œë²„ ì—ëŸ¬:", error); return []; }
    if (data && data.result && data.result.data) return data.result.data;
    return [];
  } catch (e) {
    console.error('í˜¸ì¶œ ì‹¤íŒ¨:', e);
    return [];
  }
}

  // 2. í™”ë©´ì— ë¬¼ë•Œ ë¦¬ìŠ¤íŠ¸ë¥¼ ê·¸ë¦¬ëŠ” í•¨ìˆ˜ (ìƒˆë¡œìš´ í•„ë“œëª… ë°˜ì˜)
  function updateTideDisplay(tideData) {
      const container = document.getElementById('tide-list-container'); // ì‹¤ì œ IDì— ë§ê²Œ ìˆ˜ì •
      if (!container) return;

      if (!tideData || tideData.length === 0) {
          container.innerHTML = '<div class="no-data">ë¬¼ë•Œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
          return;
      }

      // ì‹œê°„ ìˆœìœ¼ë¡œ ì •ë ¬
      tideData.sort((a, b) => a.time.localeCompare(b.time));

      const html = tideData.map(item => {
          // ë§Œì¡°(high)ëŠ” ë¹¨ê°„ìƒ‰, ê°„ì¡°(low)ëŠ” íŒŒë€ìƒ‰ ê³„ì—´ í™”ì‚´í‘œë‚˜ í…ìŠ¤íŠ¸
          const typeClass = item.type === 'high' ? 'tide-high' : 'tide-low';
          const typeText = item.type === 'high' ? 'â–² ë§Œì¡°' : 'â–¼ ê°„ì¡°';
          
          // ì˜¤ëŠ˜ ë°ì´í„°ì¸ì§€, ì–´ì œ/ë‚´ì¼ ë°ì´í„°ì¸ì§€ êµ¬ë¶„ í‘œì‹œ
          const dayLabel = item.isYesterday ? '(ì–´ì œ)' : (item.isNextDay ? '(ë‚´ì¼)' : '');

          return `
              <div class="tide-item ${typeClass}">
                  <span class="tide-day">${dayLabel}</span>
                  <span class="tide-time">${item.time}</span>
                  <span class="tide-type">${typeText}</span>
                  <span class="tide-level">(${item.level}cm)</span>
              </div>
          `;
      }).join('');

      container.innerHTML = html;
  }
  /* â”€â”€ ë¬¼ë•Œ ë¡œë“œ â”€â”€ */
  /* â”€â”€ [íŒ¨ì¹˜] ë¬¼ë•Œ ë¡œë“œ í•¨ìˆ˜ â”€â”€ */
  /* â”€â”€ [ìˆ˜ë¦¬ 1] ì–´ì œ/ë‚´ì¼ ë°ì´í„° í¬í•¨ ë¡œë”© â”€â”€ */
/* â”€â”€ ë¬¼ë•Œ ë¡œë“œ (ìµœì¢… ë‹¨ì¼ ë²„ì „) â”€â”€ */
async function loadTide(name) {
  showLoading();
  document.getElementById('wave-card').style.display = 'none';
  try {
    const s = STATIONS[name];
    const targetDate = getOffsetDate(selectedDateOffset);
    const dateStr = dateToStr(targetDate);
    const isToday = selectedDateOffset === 0;

    let tideData = [];

    if (s.type === 'blend') {
      const [r1, r2] = await Promise.all([getTideData(s.obs1, dateStr), getTideData(s.obs2, dateStr)]);
      tideData = blendTides(r1, r2, s.w1, s.w2, s.timeCorr, isToday);
    } else if (s.type === 'scale') {
      const r = await getTideData(s.obs, dateStr);
      tideData = scaleTides(r, s.scale, s.timeCorr, isToday);
    } else {
      tideData = await getTideData(s.obs, dateStr);
    }

    // ğŸŒŸ í•µì‹¬: ì˜¤ëŠ˜ì´ë©´ í˜„ì¬ìˆ˜ìœ„ ê°ì²´ ì§ì ‘ ê³„ì‚°í•´ì„œ ì‚½ì…
    if (isToday && tideData.length > 0) {
      const now = new Date();
      const nowMins = now.getHours() * 60 + now.getMinutes();
      const currentLevel = calculateLiveLevel(tideData);
      const currentObj = {
        isCurrent: true,
        level: currentLevel,
        time: minsToTime(nowMins),
        type: 'current',
        mins: nowMins
      };
      tideData.push(currentObj);
      tideData.sort((a, b) => toMins(a) - toMins(b));
    }

    const cleaned = tideData.filter(d => d && (d.isCurrent || d.time));
    if (!cleaned.length) { showError('ë°ì´í„° ì—†ìŒ'); return; }

    renderTide(cleaned, name, isToday);
    document.getElementById('update-time').textContent = `ì—…ë°ì´íŠ¸: ${new Date().toLocaleTimeString('ko-KR')}`;
  } catch(e) {
    showError('ì˜¤ë¥˜: ' + e.message);
    console.error(e);
  }
}
// 1. ëˆ„ë½ëœ ì‹¤ì‹œê°„ ìˆ˜ìœ„ ê³„ì‚°ê¸° ì¶”ê°€ (ì½”ë“œ í•˜ë‹¨ ìœ í‹¸ ë¶€ë¶„ì— ì¶”ê°€)
function calculateLiveLevel(data) {
    if (!data || data.length < 2) return 0;
    const now = new Date();
    const nowMins = now.getHours() * 60 + now.getMinutes();
    
    // í˜„ì¬ ì‹œê°„ ê¸°ì¤€ ì§ì „(past)ê³¼ ì§í›„(future) ë¬¼ë•Œ ì°¾ê¸°
    const past = [...data].reverse().find(d => !d.isCurrent && toMins(d) <= nowMins);
    const future = data.find(d => !d.isCurrent && toMins(d) > nowMins);

    // ì•ë’¤ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì²« ë²ˆì§¸ ë°ì´í„° ìˆ˜ìœ„ ë°˜í™˜
    if (!past || !future) return data[0]?.level || 0; 

    const timeDiff = toMins(future) - toMins(past);
    const levelDiff = future.level - past.level;
    const progress = (nowMins - toMins(past)) / timeDiff;

    // ì¡°ì„ ê³¡ì„ (Sì) êµ¬í˜„ì„ ìœ„í•œ ì½”ì‚¬ì¸ ë³´ê°„
    const cosineProgress = (1 - Math.cos(progress * Math.PI)) / 2;
    return Math.round(past.level + (levelDiff * cosineProgress));
}


  /* â”€â”€ ë¸”ë Œë“œ (ê¹€ë…•) â”€â”€ */
  function blendTides(data1,data2,w1,w2,timeCorr,isToday){
    const tides1=data1.filter(d=>!d.isCurrent), tides2=data2.filter(d=>!d.isCurrent);
    const current=data1.find(d=>d.isCurrent);
    const used=new Set(), blended=[];
    tides1.forEach(t1=>{
      const matched=tides2.filter(t2=>t2.type===t1.type&&!used.has(t2.time))
        .sort((a,b)=>Math.abs(toMins(a)-toMins(t1))-Math.abs(toMins(b)-toMins(t1)))[0];
      if(!matched)return; used.add(matched.time);
      const bMins=Math.round(toMins(t1)*w1+toMins(matched)*w2)+timeCorr;
      blended.push({...t1,time:minsToTime(bMins),mins:bMins,level:Math.round(t1.level*w1+matched.level*w2)});
    });
    blended.sort((a,b)=>a.mins-b.mins);
    if(isToday&&current){
      const nowMins=toMins(current); let nowLevel=current.level;
      for(let i=0;i<blended.length;i++){
        if(nowMins<blended[i].mins){
          if(i>0){const p=blended[i-1],n=blended[i];nowLevel=Math.round(p.level+(n.level-p.level)*(nowMins-p.mins)/(n.mins-p.mins));}
          break;
        }
      }
      const idx=blended.findIndex(t=>t.mins>nowMins);
      const cur={...current,level:nowLevel};
      if(idx===-1)blended.push(cur);else blended.splice(idx,0,cur);
    }
    return blended;
  }

  /* â”€â”€ ìŠ¤ì¼€ì¼ (ë§ŒëŒ€í•­) â”€â”€ */
  function scaleTides(data,scale,timeCorr,isToday){
    return data.map(item=>{
      if(item.isCurrent)return isToday?item:null;
      const newMins=toMins(item)+timeCorr;
      return{...item,time:minsToTime(newMins),mins:newMins,level:Math.round(item.level*scale)};
    }).filter(Boolean);
  }

  /* â”€â”€ ìœ í‹¸ â”€â”€ */
  function toMins(item){
    if(!item)return 0; if(item.mins!=null)return item.mins; if(!item.time)return 0;
    const[h,m]=item.time.split(':').map(Number);
    return item.isNextDay?h*60+m+1440:h*60+m;
  }
  function minsToTime(mins){
    const abs=((mins%1440)+1440)%1440;
    return String(Math.floor(abs/60)).padStart(2,'0')+':'+String(abs%60).padStart(2,'0');
  }

  /* â”€â”€ íŒŒë„ ì• ë‹ˆë©”ì´ì…˜ â”€â”€ */
  function animateWave(pct,isFalling){
    const el=document.getElementById('wave-fill');
    el.style.transition='none'; el.style.height=isFalling?'100%':'0%';
    void el.offsetWidth; el.style.transition='height 2.2s cubic-bezier(0.4,0,0.2,1)';
    setTimeout(()=>{el.style.height=pct+'%';},80);
  }

  /* â”€â”€ ê²Œì´ì§€ â”€â”€ */
  function updateGauge(data,current,isFalling){
    const nowMins=toMins(current), tides=data.filter(d=>!d.isCurrent);
    let fromTide,toTide;
    if(!isFalling){
      fromTide=[...tides].reverse().find(d=>toMins(d)<=nowMins&&d.type==='low');
      toTide=tides.find(d=>toMins(d)>nowMins&&d.type==='high');
    } else {
      fromTide=[...tides].reverse().find(d=>toMins(d)<=nowMins&&d.type==='high');
      toTide=tides.find(d=>toMins(d)>nowMins&&d.type==='low');
    }
    const highTide=isFalling?fromTide:toTide, lowTide=isFalling?toTide:fromTide;
    document.getElementById('gauge-top-label').childNodes[0].textContent=highTide?'ë§Œì¡°':'--';
    document.getElementById('gauge-top-val').textContent=highTide?highTide.level+'cm':'--';
    document.getElementById('gauge-bot-label').childNodes[0].textContent=lowTide?'ê°„ì¡°':'--';
    document.getElementById('gauge-bot-val').textContent=lowTide?lowTide.level+'cm':'--';
    const tw=tides.filter(d=>d.level!=null);
    const fL=tw.length?Math.min(...tw.map(d=>d.level)):0, fH=tw.length?Math.max(...tw.map(d=>d.level)):100;
    const lowL=lowTide?lowTide.level:fL, highL=highTide?highTide.level:fH;
    const gaugePct=Math.min(100,Math.max(0,highL>lowL?((current.level-lowL)/(highL-lowL))*100:50));
    setTimeout(()=>{
      document.getElementById('gauge-fill').style.height=gaugePct+'%';
      document.getElementById('gauge-dot').style.bottom='calc('+gaugePct+'% - 4px)';
    },80);
  }

  /* â”€â”€ ë Œë”ë§ â”€â”€ */
  /* â”€â”€ [íŒ¨ì¹˜] ë Œë”ë§ í•¨ìˆ˜ â”€â”€ */
/* â”€â”€ ë Œë”ë§ (ìµœì¢… ë²„ì „) â”€â”€ */
function renderTide(data, name, isToday) {
  if (isToday) {
    const current = data.find(d => d.isCurrent);
    if (!current) { showError('í˜„ì¬ ë°ì´í„° ì—†ìŒ'); return; }

    document.getElementById('wave-card').style.display = 'block';
    document.getElementById('station-display').textContent = `ğŸ“ ${name}`;
    document.getElementById('level-num').textContent = current.level;

    // ë¬¼ë•Œ ì´ë¦„
    const selDate = getOffsetDate(selectedDateOffset);
    const lDay = getLunarDay(selDate);
    const region = STATIONS[name]?.region;
    const tideName = getTideName(lDay, region);
    const tnEl = document.getElementById('tide-name');
    if (tideName) {
      tnEl.textContent = tideName;
      tnEl.style.display = 'inline-block';
      document.getElementById('tide-desc').textContent = TIDE_DESC[tideName] || '';
    } else {
      tnEl.style.display = 'none';
    }

    // ë‹¤ìŒ ë¬¼ë•Œ / ë°©í–¥
    const nowMins = toMins(current);
    const nextTide = data.find(d => !d.isCurrent && toMins(d) > nowMins);
    const isFalling = nextTide?.type === 'low';

    if (nextTide) {
      const diff = toMins(nextTide) - nowMins;
      const h = Math.floor(diff / 60), m = diff % 60;
      document.getElementById('tide-status').innerHTML =
        `<span>${isFalling ? 'â†“' : 'â†‘'}</span> ë¬¼ì´ ${isFalling ? 'ë¹ ì§€ëŠ” ì¤‘' : 'ì°¨ì˜¤ë¥´ëŠ” ì¤‘'}`;
      document.getElementById('time-left').textContent =
        `${isFalling ? 'ê°„ì¡°' : 'ë§Œì¡°'} ${h > 0 ? h + 'ì‹œê°„ ' : ''}${m}ë¶„ ì „`;
    }

    // íŒŒë„ ì• ë‹ˆë©”ì´ì…˜
    const levels = data.filter(d => !d.isCurrent).map(d => d.level);
    const minL = Math.min(...levels), maxL = Math.max(...levels);
    const pct = maxL > minL ? ((current.level - minL) / (maxL - minL)) * 75 + 15 : 50;
    animateWave(pct, isFalling);
    updateGauge(data, current, isFalling);
  } else {
    document.getElementById('wave-card').style.display = 'none';
  }

  // ì¡°ì„ ë¦¬ìŠ¤íŠ¸ (ì˜¤ëŠ˜/ë‹¤ë¥¸ë‚  ê³µí†µ)
  const selDate = getOffsetDate(selectedDateOffset);
  const lDay = getLunarDay(selDate);
  const region = STATIONS[name]?.region;
  const tideName = getTideName(lDay, region);
  const tideBadge = tideName
    ? `<span style="margin-left:8px;background:var(--accent);color:#0d1f2d;font-size:0.6rem;font-weight:900;padding:2px 8px;border-radius:12px;">${tideName}</span>`
    : '';

  const dateText = isToday ? 'ì˜¤ëŠ˜ ë¬¼ë•Œ' :
    `${selDate.getMonth()+1}ì›” ${selDate.getDate()}ì¼ (${WEEKDAYS[selDate.getDay()]}) ë¬¼ë•Œ`;

  let html = `<div style="display:flex;align-items:center;font-size:0.65rem;font-weight:700;color:var(--muted);letter-spacing:1px;padding:4px 4px 10px;">
    ${dateText}${tideBadge}
  </div>`;

  html += data.map(item => {
    if (item.isCurrent) {
      const now = new Date();
      const timeStr = String(now.getHours()).padStart(2,'0') + ':' + String(now.getMinutes()).padStart(2,'0');
      return `<div class="tide-item current">
        <div class="tide-item-left">
          <div class="tide-icon" style="color:#00c4a7">ğŸ“</div>
          <div><div class="tide-level-text">${item.level}cm</div><div class="tide-label">í˜„ì¬ ì˜ˆìƒ ìˆ˜ìœ„</div></div>
        </div>
        <div class="tide-time">${timeStr}</div>
      </div>`;
    }
    const isHigh = item.type === 'high';
    const color = isHigh ? '#5ba4f5' : '#ff6b6b';
    const isDim = item.isYesterday || item.isNextDay;
    const badge = item.isYesterday ? '<span class="day-badge">ì–´ì œ</span>' :
                  item.isNextDay ? '<span class="day-badge">ë‚´ì¼</span>' : '';
    return `<div class="tide-item ${isDim ? 'dim' : ''}">
      <div class="tide-item-left">
        <div class="tide-icon" style="color:${color}">${isHigh ? 'â–²' : 'â–¼'}</div>
        <div><div class="tide-level-text">${item.level}cm${badge}</div><div class="tide-label">${isHigh ? 'ë§Œì¡°' : 'ê°„ì¡°'}</div></div>
      </div>
      <div class="tide-time">${item.time}</div>
    </div>`;
  }).join('');

  document.getElementById('tide-list').innerHTML = html;
}
  function showLoading(){
    document.getElementById('tide-list').innerHTML=
      `<div class="loading"><div class="loading-wave"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div><div class="loading-text">ë°ì´í„° ë¡œë”© ì¤‘</div></div>`;
    document.getElementById('level-num').textContent='--';
    document.getElementById('tide-status').textContent='';
    document.getElementById('time-left').textContent='--';
    document.getElementById('wave-fill').style.height='0%';
  }
  function showError(msg){
    document.getElementById('tide-list').innerHTML=`<div class="error-msg">âš ï¸ ${msg}</div>`;
    document.getElementById('wave-card').style.display='none';
  }

  /* â”€â”€ ë‚ ì”¨ â”€â”€ */
  async function loadWeather(lat,lng){
    try{
      const c=(await(await fetch(
        `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lng}&current=wind_speed_10m,wind_direction_10m,weather_code&wind_speed_unit=ms&timezone=Asia/Seoul`
      )).json()).current;
      const dirs=["ë¶","ë¶ë™","ë™","ë‚¨ë™","ë‚¨","ë‚¨ì„œ","ì„œ","ë¶ì„œ"];
      const dir=dirs[Math.round(c.wind_direction_10m/45)%8];
      const emo=v=>v===0?"â˜€ï¸":v<=2?"ğŸŒ¤":v===3?"â˜ï¸":v<=48?"ğŸŒ«":v<=55?"ğŸŒ¦":v<=65?"ğŸŒ§":v<=75?"â„ï¸":v<=82?"ğŸŒ§":"â›ˆ";
      const wname=v=>v===0?"ë§‘ìŒ":v<=2?"ëŒ€ì²´ë¡œ ë§‘ìŒ":v===3?"íë¦¼":v<=48?"ì•ˆê°œ":v<=55?"ì´ìŠ¬ë¹„":v<=65?"ë¹„":v<=75?"ëˆˆ":v<=82?"ì†Œë‚˜ê¸°":"ë‡Œìš°";
      const wlv=v=>v<1.5?"ì”ì”":v<3.3?"ì•½í•œë°”ëŒ":v<5.4?"ì‚°ë“¤ë°”ëŒ":v<7.9?"ê±´ë“¤ë°”ëŒ":v<10.7?"í”ë“¤ë°”ëŒ":"ê°•í’";
      document.getElementById('w-icon').textContent=emo(c.weather_code);
      document.getElementById('w-main').textContent=`${wname(c.weather_code)} Â· ${wlv(c.wind_speed_10m)}`;
      document.getElementById('w-detail').textContent=`${dir}í’`;
      document.getElementById('w-wind').textContent=`${c.wind_speed_10m.toFixed(1)}m/s`;
      document.getElementById('weather-bar').classList.add('visible');
    }catch(e){}
  }
  /* â”€â”€ ë‹¬ë ¥ â”€â”€ */
  let calViewYear, calViewMonth;

  function openCalendar() {
    const sel = getOffsetDate(selectedDateOffset);
    calViewYear = sel.getFullYear();
    calViewMonth = sel.getMonth();
    renderCalendar();
    document.getElementById('cal-overlay').classList.add('open');
    document.getElementById('cal-sheet').classList.add('open');
  }
  function closeCalendar() {
    document.getElementById('cal-overlay').classList.remove('open');
    document.getElementById('cal-sheet').classList.remove('open');
  }
  function calShiftMonth(delta) {
    calViewMonth += delta;
    if (calViewMonth > 11) { calViewMonth = 0; calViewYear++; }
    if (calViewMonth < 0)  { calViewMonth = 11; calViewYear--; }
    renderCalendar();
  }
  function calGoToday() {
    closeCalendar();
    goToday();
  }
  function calSelectDate(year, month, day) {
    const today = new Date(); today.setHours(0,0,0,0);
    const picked = new Date(year, month, day);
    selectedDateOffset = Math.round((picked - today) / 86400000);
    updateLunarDisplay();
    updateDateNav();
    if (currentStation) loadTide(currentStation);
    closeCalendar();
  }
  function renderCalendar() {
    const today = new Date(); today.setHours(0,0,0,0);
    const sel = getOffsetDate(selectedDateOffset);
    sel.setHours(0,0,0,0);
    document.getElementById('cal-month-label').textContent =
      `${calViewYear}ë…„ ${calViewMonth + 1}ì›”`;
    const firstDay = new Date(calViewYear, calViewMonth, 1).getDay();
    const lastDate = new Date(calViewYear, calViewMonth + 1, 0).getDate();
    const days = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
    let html = days.map((d,i) =>
      `<div class="cal-day-label" style="${i===0?'color:#ff6b6b':i===6?'color:#5ba4f5':''}">${d}</div>`
    ).join('');
    // ì´ì „ ë‹¬ ë¹ˆì¹¸
    const prevLast = new Date(calViewYear, calViewMonth, 0).getDate();
    for (let i = 0; i < firstDay; i++) {
      const d = prevLast - firstDay + 1 + i;
      html += `<div class="cal-day other-month">${d}</div>`;
    }
    // ì´ë²ˆ ë‹¬
    for (let d = 1; d <= lastDate; d++) {
      const thisDate = new Date(calViewYear, calViewMonth, d);
      const isToday = thisDate.getTime() === today.getTime();
      const isSel = thisDate.getTime() === sel.getTime();
      const dow = thisDate.getDay();
      const cls = [
        'cal-day',
        isToday && !isSel ? 'today' : '',
        isSel ? 'selected' : '',
        dow === 0 ? 'sunday' : dow === 6 ? 'saturday' : ''
      ].filter(Boolean).join(' ');
      html += `<div class="${cls}" onclick="calSelectDate(${calViewYear},${calViewMonth},${d})">${d}</div>`;
    }
    // ë‹¤ìŒ ë‹¬ ë¹ˆì¹¸
    const total = firstDay + lastDate;
    const remain = total % 7 === 0 ? 0 : 7 - (total % 7);
    for (let i = 1; i <= remain; i++) {
      html += `<div class="cal-day other-month">${i}</div>`;
    }
    document.getElementById('cal-grid').innerHTML = html;
  }
  /* â”€â”€ ìƒˆë¡œê³ ì¹¨ â”€â”€ */
  async function refresh(){
    if(!currentStation)return;
    const btn=document.getElementById('refresh-btn');
    btn.classList.add('spinning');
    setTimeout(()=>btn.classList.remove('spinning'),800);
    const s=STATIONS[currentStation];
    await Promise.all([loadTide(currentStation),loadWeather(s.lat,s.lng)]);
  }

  /* â”€â”€ ìŠ¤í”Œë˜ì‹œ â”€â”€ */
  function makeSplashStars(){
    const container=document.getElementById('splash-stars');
    for(let i=0;i<60;i++){
      const s=document.createElement('div'); s.className='splash-star';
      s.style.cssText=`left:${Math.random()*100}%;top:${Math.random()*55}%;--dur:${2+Math.random()*4}s;--delay:${Math.random()*4}s;--op:${0.3+Math.random()*0.7};width:${Math.random()<0.2?3:2}px;height:${Math.random()<0.2?3:2}px;`;
      container.appendChild(s);
    }
  }
  function setSplashProgress(pct,text,duration){
    const waterEl=document.getElementById('splash-water'),dur=duration??1.1;
    waterEl.style.transition=pct===0?'none':`height ${dur}s cubic-bezier(0.2,0.8,0.3,1)`;
    waterEl.style.height=(pct*0.55)+'%';
    if(text)document.getElementById('splash-status-text').textContent=text;
  }
  function hideSplash(){
    const el=document.getElementById('splash'); el.classList.add('hide');
    setTimeout(()=>{el.style.display='none';},650);
  }

  /* â”€â”€ ì‹œì‘ â”€â”€ */
  window.addEventListener('DOMContentLoaded',async()=>{
    makeSplashStars();
    updateLunarDisplay();
    updateDateNav();

    const last=localStorage.getItem('lastStation');
    if(!last||!STATIONS[last]){
      setTimeout(()=>setSplashProgress(60,'',1.4),100);
      setTimeout(hideSplash,1400); return;
    }

    const region=STATIONS[last].region, rInfo=REGION_INFO[region];
    document.getElementById('loc-icon').textContent=EMOJI[last]||'ğŸ“';
    document.getElementById('loc-text').textContent=`${rInfo.label} Â· ${last}`;
    currentStation=last;

    setSplashProgress(10,'ê´€ì¸¡ì†Œ í™•ì¸ ì¤‘',0.8);
    const s=STATIONS[last];
    const weatherPromise=loadWeather(s.lat,s.lng).catch(()=>{});
    let tideData=null;
    try{
      const dateStr=dateToStr(getOffsetDate(0));
      if(s.type==='blend'){
        setSplashProgress(35,'ì¡°ì„ ë°ì´í„° ìˆ˜ì‹  ì¤‘',1.2);
        const [r1,r2]=await Promise.all([getTideData(s.obs1,dateStr),getTideData(s.obs2,dateStr)]);
        setSplashProgress(75,'ë°ì´í„° ì²˜ë¦¬ ì¤‘',1.5);
        tideData=blendTides(r1,r2,s.w1,s.w2,s.timeCorr,true);
      } else if(s.type==='scale'){
        setSplashProgress(35,'ì¡°ì„ ë°ì´í„° ìˆ˜ì‹  ì¤‘',1.2);
        tideData=scaleTides(await getTideData(s.obs,dateStr),s.scale,s.timeCorr,true);
        setSplashProgress(75,'ë°ì´í„° ì²˜ë¦¬ ì¤‘',1.5);
      } else {
        setSplashProgress(35,'ì¡°ì„ ë°ì´í„° ìˆ˜ì‹  ì¤‘',1.2);
        tideData=await getTideData(s.obs,dateStr);
        setSplashProgress(75,'ë°ì´í„° ì²˜ë¦¬ ì¤‘',1.5);
      }
    }catch(e){tideData=null;}

    await weatherPromise;
    setSplashProgress(95,'í™”ë©´ ì¤€ë¹„ ì¤‘',1.0);
    await new Promise(r=>setTimeout(r,200));

    if(tideData){
      const cleaned=tideData.filter(d=>d&&(d.isCurrent||d.time));
      if(cleaned.length&&!cleaned[0]?.error){
        document.getElementById('wave-card').style.display='block';
        renderTide(cleaned,last,true);
        document.getElementById('update-time').textContent=`ì—…ë°ì´íŠ¸: ${new Date().toLocaleTimeString('ko-KR')}`;
      }
    }

    setSplashProgress(100,'ì¤€ë¹„ ì™„ë£Œ âœ“',0.5);
    await new Promise(r=>setTimeout(r,380));
    hideSplash();
  });

  setInterval(()=>{if(currentStation&&selectedDateOffset===0)refresh();},600000);

  if("serviceWorker" in navigator){
    navigator.serviceWorker.register("/seatime/sw.js").catch(()=>{});
  }



  </body>
  </html>
